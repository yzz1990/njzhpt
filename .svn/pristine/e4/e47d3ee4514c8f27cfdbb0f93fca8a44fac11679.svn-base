<%
 layout("/WEB-INF/web/ui/globalStyleDialog.html"){
%>

	
	<!----------- shiping ------------>
	<script src="${ctxPath}/js/preview.js?version=3.0.4.150415"></script>
	<!----------- shiping ------------>
	<link rel="stylesheet" href="${ctxPath}/css/bootstrap.css" >
	<script type="text/javascript"  src="${ctxPath}/web/echarts.js"></script>
	<!--  
	<script type="text/javascript"  src="${ctxPath}/resource/echarts.simple.min.js"></script>
	-->
	 <style type="text/css">
    	div{
    		
    		float:left;
    	}
    	.shiping{
    		width:230px;
    		margin-right:10px;
    	}
    	.biaoge{
    		width:1000px;
    		height:200px;
    	}
    	#base{
    	 	width:1000px;
    	 	height:600px;
   
    	}
    	.form-inline{
    		margin-top:20px;
    		padding-left:10px;
    	}
    	.div-lsxz, .div-lspz, .div-lsdj, .div-zylx, .div-time{
			float:left;
		}
		.uu1124{
			font-size:13px;
			width:70px;
			display:inline-block;
			font-color:black;
			font-weight:bold;
			text-align:right;
			color: black;
		}
		.u1128{
			font-size:13px;
			width:80px;
			float:left;
			display:inline-block;
			font-weight:bold;
			color:black;
		}
		.lsxzmx{
			width:180px;
		}
		.kczbtb{
			width:250px;
			height:200px;
			margin-left:20px;
		}
		.lsxx{
			width:250px;
			height:200px;
			margin-left:20px;
		}
		.datatables{
			color:#464343;
		}
		.zhongjian{
			border-width: 0 0 0 1px;
			border-style: solid;
			border-color: #B0C4DE;
		}
		.kcmm{
			width:180px;
		}
		.dataTables_empty{
			text-align:center;
		}
		.pagination{
			color: red;
		}
    </style>
    
    <script type="text/javascript">
    var mxindex=0;
    $.fn.datetimepicker.dates['zh'] = {  
            days:       ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六","星期日"],  
            daysShort:  ["日", "一", "二", "三", "四", "五", "六","日"],  
            daysMin:    ["日", "一", "二", "三", "四", "五", "六","日"],  
            months:     ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月","十二月"],  
            monthsShort:  ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"],  
            meridiem:    ["上午", "下午"],  
            //suffix:      ["st", "nd", "rd", "th"],  
            today:       "今天"  
    };  
    Array.prototype.S=String.fromCharCode(2);
    Array.prototype.in_array=function(e){
        var r=new RegExp(this.S+e+this.S);
        return (r.test(this.S+this.join(this.S)+this.S));
    };
    (function ($) {
 	      $.getUrlParam = function (name) {
 	            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
 	            var r = decodeURI(window.location.search).substr(1).match(reg);
 	            if (r != null) return unescape(r[2]); return null;
 	        }
	     })(jQuery);
    var datatable;
    var qyzzjgdm = $.getUrlParam("qyzzjgdm");
	var kdbm = $.getUrlParam("kdbm");
	var kdmc = $.getUrlParam("kdmc");
	var date = new Date;
	var year=parseInt(date.getFullYear());
	var nowday1 = date.toLocaleDateString();
	
	var zycbs = "('1','111','112','119','11')";
	var sjcbs = "('121')";
	var shjcbs = "('122')";
	var xjcbs = "('123')";
	var lscbs = "('32','33','34')";
	var spls = "('2','21','22','29')";
	var zdjs = "('31')";
	var qts = "('129','99')";
	
	/*
	var zycbs = "(1,111,112,119,11)";
	var sjcbs = "(121)";
	var shjcbs = "(122)";
	var xjcbs = "(123)";
	var lscbs = "(32,33,34)";
	var spls = "(2,21,22,29)";
	var zdjs = "(31)";
	var qts = "(129,99)";
	*/
	
    $(function(){
    	
    	$('#qssj').datetimepicker({
			minView: "month",
			format:'yyyy-mm-dd',
			language: 'zh-CN',
			autoclose: 1,
			startView: 2,
		});
    	//form_datetimebegin
    	$('.form_datetimebegin').datetimepicker({  
    		minView: "month",
			format:'yyyy-mm-dd',
			language: 'zh-CN',
			autoclose: 1,
			startView: 2,
           // pickerPosition:bottom-right
        }).on('changeDate', function (ev) {  
            $(this).datetimepicker('hide'); 
        }).on('show', function (ev) {  
            $(".prev i").removeClass("glyphicon");
            $(".prev i").removeClass("icon-arrow-left");
            $(".next i").removeClass("glyphicon");
            $(".next i").removeClass("icon-arrow-left");
            $(".prev i").addClass("fa");
            $(".prev i").addClass("fa-arrow-left");
            $(".next i").addClass("fa");
            $(".next i").addClass("fa-arrow-right"); 
        });
    	$('.form_datetimeend').datetimepicker({  
    		minView: "month",
			format:'yyyy-mm-dd',
			language: 'zh-CN',
			autoclose: 1,
			startView: 2,
           // pickerPosition:bottom-right
        }).on('changeDate', function (ev) {  
            $(this).datetimepicker('hide');  
        }).on('show', function (ev) {  
            $(".prev i").removeClass("glyphicon");
            $(".prev i").removeClass("icon-arrow-left");
            $(".next i").removeClass("glyphicon");
            $(".next i").removeClass("icon-arrow-left");
            $(".prev i").addClass("fa");
            $(".prev i").addClass("fa-arrow-left");
            $(".next i").addClass("fa");
            $(".next i").addClass("fa-arrow-right"); 
        });  
    	$(".form_datetimebegin").datetimepicker({format: 'yyyy-mm-dd'});
    	$(".form_datetimeend").datetimepicker({format: 'yyyy-mm-dd'});
    	$(".input-sm-zylx").select2();
    	$(".input-sm-lsxz").select2();
    	$(".input-sm-lspz").select2();
    	$(".input-sm-lsdj").select2();
    	$(".input-sm-nianfen").select2();
    	var bday = year+"-01-01";
    	var eday = year+"-12-31";
    	var ss=nowday1.split('/');
    	if(ss[1]<10){
    		ss[1]="0"+ss[1];
    	}
    	if(ss[2]<10){
    		ss[2]="0"+ss[2];
    	}
    		var nowday = ss[0]+"-"+ss[1]+"-"+ss[2];
    	
    	
    	$('.form_datetimebegin').val(bday);
		$('.form_datetimeend').val(nowday);
    	$(".datatables").removeAttr("data-queryparam");
    	$(".datatables").attr("data-queryparam","&qyzzjgdm="+qyzzjgdm+"&kdbm="+kdbm+"&dtRegistrateTime="+bday+"&vEndTime="+eday);
    	datatable = $('.datatables').DataTable({
    		"pageLength": 8,
    		"lengthMenu": [
    		       		[8,16,24,32,10000],
    		       		[8,16,24,32, "所有"]
    		       	],
            "columns": [
				{
					height:39,
					"render": function (data,type,row,meta) {
						var vurl = '${ctxPath}/shouchukeshihua/churuku/madan.html/?vSwiftNumber='+row["vSwiftNumber"]+'&qyzzjgdm='+qyzzjgdm+'&kdbm='+kdbm+'&kdmc='+kdmc+'&vDirection='+row["vDirection"];
						var url = encodeURI(vurl);
						var chakan = "";
						if(row["vDirection"]=="入库"||row["vDirection"]=="收购"||row["vDirection"]=="出库"||row["vDirection"]=="出库损耗"){		
							 chakan = '<a  href="javascript:void(0)" onclick="getmadan(\''+url+'\')">'+row["vSwiftNumber"]+'</a>';								
						}else{
							 chakan = '<a  href="javascript:void(0)" onclick="javascript:alert(\'无码单信息！\');">'+row["vSwiftNumber"]+'</a>';		
						} 
						return chakan;								
					}
				},{
					height:39,
    				//"data" : "dtRegistrateTime",
    				"render": function (data,type,row,meta) {
	   					var url = '${ctxPath}/shouchukeshihua/churuku/madan.html';
	   					var chakan = '<p>'+row["dtRegistrateTime"].substring(0,10)+'</p>';								
	   					return chakan;								
   					}
    			},{
    				height:39,
    				"data" : "vViechelNumber"
    			},{
    				height:39,
    				"data" : "vName"
    			},{
    				height:39,
    				"data" : "vGrainProperties"
    			},{
    				height:39,
    				"render": function (data,type,row,meta) {
	   					var chakan = '<p>'+(row["dmNW"]/1000).toFixed(3)+'</p>';								
	   					return chakan;								
   					}
    			},{
    				height:39,
    				"data" : "year"
    			},{
    				height:39,
    				"data" : "grade",
    				"render":function(data,type,row,meta){
    					var dengji="";
    					if(dengji=="01"){
    						dengji="一等";
    					}else if(dengji=="02"){
    						dengji="二等";
    					}else if(dengji=="04"){
    						dengji="四等";
    					}else if(dengji=="05"){
    						dengji="五等";
    					}else if(dengji=="06"){
    						dengji="等外粮";    						
    					}else{
    						dengji="三等";    						    						
    					}
    					return dengji;
    				}
    			},{
    				height:39,
    				"data" : "vWareHouseCode"
    			},{
    				height:39,
    				"data" : "vDirection"
    			}
    			]
    	});
    	//==============================datagrid加载完成后处理======================================
    	$('.datatables').on( 'draw.dt', function () {
    		mxindex++;
        	var zylx = $(".input-sm-zylx option:selected").val();
        	if(zylx != "" && zylx != null && zylx != "请选择"){
	    		var liushui = $(".input-sm-liushui").val();
	        	var time = $(".form_datetimebegin").val();
	        	var cfbh = $(".input-sm-cfbh").val();
	        	var lsxz = $(".input-sm-lsxz option:selected").val();
	        	var endtime = $(".form_datetimeend").val();
	        	var lspz = $(".input-sm-lspz option:selected").val();
	        	var lsdj = $(".input-sm-lsdj option:selected").val();
	        	var nianfen = $(".input-sm-nianfen option:selected").val();
	    		
	        	$(".datatables").attr("data-queryparam","&qyzzjgdm="+qyzzjgdm);
	        	$(".datatables").attr("data-queryparam","&kdbm="+kdbm);
	        	var mxdata={};
	        	mxdata.qyzzjgdm=qyzzjgdm;
	        	mxdata.kdbm=kdbm;
	        	if(liushui != "" && liushui != null){
	        		mxdata.vSwiftNumber=liushui;
	        	}
	        	/* if(time != "" && time != null){
	        		mxdata.dtRegistrateTime=time;
	        	} */
	        	if(lsxz != "" && lsxz != null && lsxz != "请选择"){
	        		mxdata.vGraPorCode=lsxz;
	        	}
	            if(endtime != "" && endtime != null){
	        		mxdata.vEndTime=endtime;
	        	} 
	        	if(zylx != "" && zylx != null && zylx != "请选择"){
	        		mxdata.vDirection=zylx;
	        	}
	        	if(lspz != "" && lspz != null && lspz != "请选择"){
	        		mxdata.vGraTypeCode=lspz;
	        	}
	        	if(lsdj != "" && lsdj != null && lsdj != "请选择"){
	        		mxdata.vGrainLevel=lsdj;
	        	}
	        	/*	if(nianfen != "" && nianfen != null && nianfen != "请选择"){ 注释 2017-07-05 
	        	 	var start=time.substring(0,4);
	        		var end=endtime.substring(0,4);
	        		if(nianfen<start||nianfen>end){
	        			$("#hejitr").hide();
	        			alert("所选年份不在日期区间之间！");
	        		}else{ */
	        			if(time>endtime){
	        				alert("起始日期不能大于结束日期！");
	        				return false;
	        			}
	        			mxdata.dtRegistrateTime=time;
	        			/* var newstart=nianfen+"-01"+"-01";
	        			var newend=nianfen+"-12"+"-30";
	        			if(newstart<=time){
	        			}else{
	        				mxdata.dtRegistrateTime=newstart;
	        			} */
	        			//加载合计方法
	   	        	 $("#hejitr").show();
	   		        $.ajax({
	   		        		url: "${ctxPath}/shouchukeshihua/minxiheji.do",
	   		        		dataType: "json",
	   		        		data:mxdata,
	   		        		success: function(data) {
	   		        		var heji=0;
	   		        		if(null!=data.list[0]){
	   		        			heji=data.list[0].weight;
	   		        		}
	   		        		$("#mxheji").text(parseFloat(heji).toFixed(3));
	   		        	},
	   		        	error:function(){
	   		        		alert("加载合计失败");
	   		        	}
	   		        }); 
	        	/* 	}       			
	        	} */
	        	
        	}else{
        		$("#hejitr").hide();
        		if(mxindex>1){
	        		$.notify({
	        			// options
	        			message: '如果查看合计请选择具体作业类型！',
	        		});
        		}
        	}
    		
    		/* $('.form_datetimebegin').val(bday);
    		$('.form_datetimeend').val(nowday); */
    		
    	});
    	//==============================datagrid加载完成处理结束======================================
    	//=======================================加载年度===============================
    	for(var i = 0; i < 5; i++){
    		$(".input-sm-nianfen").append("<option value='"+(year - i)+"'>"+(year - i)+"</option>");	
    	}	
    	//==========================加载粮食性质下拉框=========================
    		var op = '<option value="请选择" selected="selected">全部</option>';
			//$(".input-sm-lsxz").append(op);
			$(".input-sm-lsdj").append(op);
			//$(".input-sm-zylx").append(op);
			
			$(".div-lsxz").find(".select2-selection__rendered").text("全部");
	    	$(".div-lspz").find(".select2-selection__rendered").text("全部");
	    	$(".div-lsdj").find(".select2-selection__rendered").text("全部");
	    	$(".div-zylx").find(".select2-selection__rendered").text("全部");
	    	
	    	$(".div-lsxz").find(".select2-selection__rendered").attr("title","全部");
	    	$(".div-lspz").find(".select2-selection__rendered").attr("title","全部");
	    	$(".div-lsdj").find(".select2-selection__rendered").attr("title","全部");
	    	$(".div-zylx").find(".select2-selection__rendered").attr("title","全部");
			/*
			$.ajax({
				url:'${ctxPath}/shouchukeshihua/querylsxz.do',
				type:'post',
				dataType:'json',
				success:function(data){
					$.each(data.list,function(i, n){
						op = '<option value='+n.vCode+'>'+n.vGrainProperties+'</option>';
						$(".input-sm-lsxz").append(op);
					});	
				},
				error:function(){
					alert("加载粮食性质下拉框失败");
				}
			});
			*/
    		//====================加载粮食品种========================
    		//2017-02-16 品种固定写死（大类）查询时包含小类
    		/* $.ajax({
    			url:'${ctxPath}/shouchukeshihua/querylspz.do',
    			type:'post',
    			dataType:'json',
    			success:function(data){
    				$.each(data.list,function(i, n){
						op = '<option value='+n.vName+'>'+n.vName+'</option>';
						$(".input-sm-lspz").append(op);
					});	
    			},
    			error:function(){
    				alert("加载粮食品种失败");
    			}
    		}); */
    		//=================加载粮食等级============================
    		$.ajax({
    			url:'${ctxPath}/shouchukeshihua/querylsdj.do',
    			type:'post',
    			dataType:'json',
    			success:function(data){
    				$.each(data.list,function(i, n){
						op = '<option value='+n.vCode+'>'+n.vLevelName+'</option>';
						$(".input-sm-lsdj").append(op);
					});	
    			},
    			error:function(){
    				alert("加载粮食等级失败");
    			}
    		});
    		
    		//=======================加载作业类型=======================
    		/*
    		var pt = [];
    		var pz = [];
    		var zy = [];
    		$.ajax({
    			url:'${ctxPath}/shouchukeshihua/querymingxi.do',
    			type:'post',
    			data:{"qyzzjgdm":qyzzjgdm,"kdbm":kdbm,"page":1,"rows":1000},
    			dataType:'json',
    			success:function(data){
    				var op = '<option value="请选择">请选择</option>';
    				$(".input-sm-lsxz").append(op);
    				$(".input-sm-lspz").append(op);
    				$(".input-sm-lsdj").append(op);
    				$(".input-sm-zylx").append(op);
    				
    				//加载粮食等级
					for(var i = 1; i <= 4; i++){
						var op = '<option value='+data.list[i].vGrainLevel+'>'+i+'</option>';
						$(".input-sm-lsdj").append(op);
					}
    				
    				for(var i = 0; i < data.list.length; i++){
    					//加载粮食性质
    					if(!pt.in_array(data.list[i].vGrainProperties) && (data.list[i].vGrainProperties != null)){
    						pt.push(data.list[i].vGrainProperties);
    						var op = '<option value='+data.list[i].vGrainProperties+'>'+data.list[i].vGrainProperties+'</option>';
    						$(".input-sm-lsxz").append(op);
    					}
    					//加载粮食品种
    					if(!pz.in_array(data.list[i].vName) && (data.list[i].vName != null)){
    						pz.push(data.list[i].vName);
    						var op = '<option value='+data.list[i].vName+'>'+data.list[i].vName+'</option>';
    						$(".input-sm-lspz").append(op);
    					}
    					
    					//加载作业类型
    					if(!zy.in_array(data.list[i].vDirection) && (data.list[i].vDirection != null)){
    						zy.push(data.list[i].vDirection);
    						var op = '<option value='+data.list[i].vDirection+'>'+data.list[i].vDirection+'</option>';
    						$(".input-sm-zylx").append(op);
    					}
    				}
    			},
    			error:function(){
    				alert("加载粮食性质下拉框失败");
    			}
    		});
    		*/
    		
    		//库点名称单击事件展示库点存储状况
   			var myChart = echarts.init(document.getElementById('kczbtb'));
    		$.ajax({
    			url:'${ctxPath}/jibenxinxi/queryCfZcr',
    			type:'post',
    			data:{"qyzzjgdm":qyzzjgdm,"kdmc":kdmc,"page":1,"rows":1},
    			dataType:'json',
    			success:function(data){
    				//$(".zongcangrong").text((data.list[0].zcr).toFixed(3));
    				var zcr = data.list[0].zcr;
    				$.ajax({
    					url:'${ctxPath}/jibenxinxi/queryCfZkc',
    					type:'post',
    					data:{"qyzzjgdm":qyzzjgdm,"kdbm":kdbm,"page":1,"rows":1},
    					dataType:'json',
    					success:function(data){
    						//$(".shishikucun").text((data.list[0].dmStock).toFixed(3));
    						var kczb = data.list[0].dmStock;
    						var syzb = zcr - kczb;
    						$("#ukucun").text(kczb.toFixed(3));
    	   					$("#usykucun").text(syzb.toFixed(3));
    	   					option = {
    								title : {
    							        x:'left',
    							        textStyle:{
    							        	fontSize:15
    							        }
    							    },
    							    tooltip: {
    							        trigger: 'item',
    							        formatter: "{b}<br/>  ({d}%)"
    							    },
    							    color : ['#61a0a8', '#87CEFA', '#91c7ae','#749f83',  '#ca8622', '#bda29a','#6e7074', '#546570', '#c4ccd3'],
    							   
    							    series: [
    							        {
    							            name:'数量(占比)',
    							            type:'pie',
    							            radius: ['50%', '70%'],
    							            avoidLabelOverlap: false,
    							            label: {
    							                normal: {
    							                	show: false,
    							                    position: 'center',
    							                    textStyle: {
    							                        fontSize: '20',
    							                        fontWeight: 'bold'
    							                    }
    							                },
    							                emphasis: {
    							                    show: true,
    							                    textStyle: {
    							                        fontSize: '20',
    							                        fontWeight: 'bold'
    							                    }
    							                }
    							            },
    							            itemStyle : {
    							                normal : {
    							                    label : {
    							                        show : false
    							                    },
    							                    labelLine : {
    							                        show : false
    							                    }
    							                },
    							                emphasis : {
    							                    label : {
    							                        show : true,
    							                        position : 'center',
    							                        textStyle : {
    							                            fontSize : '30',
    							                            fontWeight : 'bold'
    							                        }
    							                    }
    							                }
    							            },
    							            
    							            data:[
    							                {value:kczb.toFixed(3), name:'实时库存'},
    							                {value:syzb.toFixed(3), name:'剩余仓容'},
    							            ]
    							        }
    							    ]
    							};
    	   					myChart.setOption(option);	
    						
    					},
    					error:function(){
    						
    					}
    					
    				});
    				
    			},
    			error:function(){
    			}
    		});
    		
    		//==================================库点名称单击结束======================================
    			
    		//==========================加载粮食性质=================================================
    		var zycb = 0.000;
			var sjcb = 0.000;
			var shjcb = 0.000;
			var xjcb = 0.000;
			var lscb = 0.000;
			var spl = 0.000;
			var zdj = 0.000;
			var qtcb = 0.000;
			
    		var myChart1 = echarts.init(document.getElementById('lsxx'));
    		$.ajax({
    			url:'${ctxPath}/shouchukeshihua/queryliangqing.do',
    			type:'post',
    			data:{"qyzzjgdm":qyzzjgdm,"kdbm":kdbm,"page":1,"rows":100},
    			dataType:'json',
    			success:function(data){
    				for(var i = 0; i < data.list.length; i++){
    					if(data.list[i].vGrainPropertyId.substring(0,2) == '11' || data.list[i].vGrainPropertyId.substring(0,2) == '1'){
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						zycb += parseFloat(num);
    					}else if(data.list[i].vGrainPropertyId == '121'){
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						sjcb = num;
    						$("#sjcb").text(sjcb.toFixed(3));
    					}else if(data.list[i].vGrainPropertyId == '122'){
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						shjcb = num;
    						$("#shjcb").text(shjcb.toFixed(3));
    					}else if(data.list[i].vGrainPropertyId == '123'){
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						xjcb = num;
    						$("#xjcb").text(xjcb.toFixed(3));
    					}else if(data.list[i].vGrainPropertyId.substring(0,1) == '2'){
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						spl += parseFloat(num);
    					}else if(data.list[i].vGrainPropertyId == '32'
    							|| data.list[i].vGrainPropertyId == '33'
    							|| data.list[i].vGrainPropertyId == '34'){
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						lscb += parseFloat(num);
    						
    					}else if(data.list[i].vGrainPropertyId.substring(0,1) == '31'){
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						zdj = parseFloat(num);
    						$("#zdj").text(zdj.toFixed(3));
    					}else{
    						var num = (parseFloat(data.list[i].sum));
   							if(isNaN(num)){
 								num = 0.000;
 							}
    						qtcb += parseFloat(num);
    					}
    
    					//$("#uu1122").text(zycb+sjcb+shjcb+xjcb+lscb+spl);
    				}
    				$("#zycb").text(zycb.toFixed(3));
    				$("#spl").text(spl.toFixed(3));
    				$("#qtcb").text(qtcb.toFixed(3));
    				$("#lscb").text(lscb.toFixed(3));
    				option1 = {
							title : {
						        x:'left',
						        textStyle:{
						        	fontSize:15
						        }
						    },
						    tooltip: {
						        trigger: 'item',
						        formatter: "{b}:<br/> ({d}%)"
						    },
			
						    color : ['#66CCCC', '#99CC33', '#FF9900','#FFCC00','#666633', '#666699','#b6a2de','#ffb980'],
						    /* color : ['#b6a2de', '#5ab1ef', '#ffb980','#d87a80','#8d98b3', '#f5994e','#9370DB', '#0000FF', '#c4ccd3'], */
						    normal: {
			                    position: 'inner',
			                    /*
			                    label: { show: function () {
		                            if (value == 0.00)
		                            { return false; }
			                        } ()
		                        },
		                        labelLine: { show: function () {
		                            if (value == 0.00)
		                            { return false; }
			                        } ()
		                        }*/
			                },
						    series: [
						        {
						            name:'数量(占比)',
						            type:'pie',
						            radius: ['0%', '70%'],
						            avoidLabelOverlap: false,
						            label: {
						                normal: {
						                	show: false,
						                    //position: 'center'
						                     
						                },
						            },
						            data:[
						                {value:zycb, name:'中央储备',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (zycb == 0.00)
						                                 { return false; }
						                             } ()

						                             },
						                             labelLine: { show: function () {
						                                 if (zycb == 0.00)
						                                 { return false; }
						                             } ()

						                             }
						                         }
						                     }
						                },
						                {value:sjcb, name:'省级储备',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (sjcb == 0.00)
						                                 { return false; }
						                             } ()

						                             },
						                             labelLine: { show: function () {
						                                 if (sjcb == 0.00)
						                                 { return false; }
						                             } ()

						                             }
						                         }
						                     }
						                },
						                {value:shjcb, name:'市级储备',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (shjcb == 0.00)
						                                 { return false; }
						                             } ()

						                             },
						                             labelLine: { show: function () {
						                                 if (shjcb == 0.00)
						                                 { return false; }
						                             } ()

						                             }
						                         }
						                     }
						                },
						                {value:xjcb, name:'县级储备',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (xjcb == 0.00)
						                                 { return false; }
						                             } ()

						                             },
						                             labelLine: { show: function () {
						                                 if (xjcb == 0.00)
						                                 { return false; }
						                             } ()

						                             }
						                         }
						                     }
						                },
						                {value:lscb, name:'临时储备',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (lscb == 0.00)
						                                 { return false; }
						                             } ()

						                             },
						                             labelLine: { show: function () {
						                                 if (lscb == 0.00)
						                                 { return false; }
						                             } ()

						                             }
						                         }
						                     }
						                },
						                {value:spl, name:'商品粮',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (spl == 0.00)
						                                 { return false; }
						                             } ()
						                             },
						                             labelLine: { show: function () {
						                                 if (spl == 0.00)
						                                 { return false; }
						                             } ()
						                             }
						                         }
						                     }
						                },
						                {value:zdj, name:'最低价收购',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (zdj == 0.00)
						                                 { return false; }
						                             } ()
						                             },
						                             labelLine: { show: function () {
						                                 if (zdj == 0.00)
						                                 { return false; }
						                             } ()
						                             }
						                         }
						                     }
						                },
						                {value:qtcb, name:'其他储备粮',
						                	itemStyle: {
						                         normal: {
						                             label: { show: function () {
						                                 if (qtcb == 0.00)
						                                 { return false; }
						                             } ()
						                             },
						                             labelLine: { show: function () {
						                                 if (qtcb == 0.00)
						                                 { return false; }
						                             } ()
						                             }
						                         }
						                     }
						                },
						            ]
						        }
						    ]
						};
   					myChart1.setOption(option1);	
    				
    			},
    			error:function(){
    				
    			}
    		});
    		//==========================加载粮食性质=================================================
    			
    			
    		//=======================================获取当前季度====================================
    		$.ajax({
    			url:'${ctxPath}/shouchukeshihua/findndjd',
    			type:'post',
    			dataType:'json',
    			success:function(data){
    				$("#djlsxz").text(data.data.ndjd+"各粮食性质收购量");
    			},
    			error:function(){
    				//alert("加载季度失败");
    			}
    		});
    });
    
    function getmadan(url){
    	if($("#u1125if").attr("src") != "" && $("#u1125if").attr("src") != null){
    		$("#spclose").hide();
    	}
    	dialog1=top.BootstrapDialog.show({
		    title: '出入库明细',
		    message:$('<iframe frameborderno="0"  style="width:100%;height:100%;" frameborder="0" scrolling="yes" src="'+url+'"/>'),
		    onshow:function(dlg){
	       	dlg.$modalDialog.css("width","1050px");//modal-dialog
	       	$(".bootstrap-dialog-message", dlg.$modalContent).css("height","600px");//modal-dialog
	       },
	      
		});
    }

    function doSearch(){
    	var liushui = $(".input-sm-liushui").val();
    	var time = $(".form_datetimebegin").val();
    	var cfbh = $(".input-sm-cfbh").val();
    	var lsxza = $(".input-sm-lsxz option:selected").val();
    	var lsxz = lsxza;
    	var endtime = $(".form_datetimeend").val();
    	var zylx = $(".input-sm-zylx option:selected").val();
    	var lspz = $(".input-sm-lspz option:selected").val();
    	var lsdj = $(".input-sm-lsdj option:selected").val();
    	var nianfen = $(".input-sm-nianfen option:selected").val();
    	if(time>endtime){
    		alert("起始时间不能大于终止时间!");
    		return false;
    	}
    	/*
    	$(".div-lsxz").find(".select2-selection__rendered").text("请选择");
    	$(".div-lspz").find(".select2-selection__rendered").text("请选择");
    	$(".div-lsdj").find(".select2-selection__rendered").text("请选择");
    	$(".div-zylx").find(".select2-selection__rendered").text("请选择");
    	
    	$(".input-sm-lsxz").find("option[text='请选择']").attr("selected",true);
    	$(".input-sm-zylx").find("option[text='请选择']").attr("selected",true);
    	$(".input-sm-lspz").find("option[text='请选择']").attr("selected",true);
    	$(".input-sm-lsdj").find("option[text='请选择']").attr("selected",true);
    	
    	$(".div-lsxz").find(".select2-selection__rendered").attr("title","请选择");
    	$(".div-lspz").find(".select2-selection__rendered").attr("title","请选择");
    	$(".div-lsdj").find(".select2-selection__rendered").attr("title","请选择");
    	$(".div-zylx").find(".select2-selection__rendered").attr("title","请选择");
    	*/
    	$(".datatables").removeAttr("data-queryparam");
    	$(".datatables").attr("data-queryparam","&qyzzjgdm="+qyzzjgdm);
    	$(".datatables").attr("data-queryparam","&kdbm="+kdbm);
    	var attrstr = "&qyzzjgdm=" + qyzzjgdm + "&kdbm=" + kdbm;
    	if(liushui != "" && liushui != null){
    		attrstr += "&vSwiftNumber="+liushui;
    	}
    	if(time != "" && time != null){
    		attrstr += "&dtRegistrateTime="+time;
    	}
    	if(cfbh != "" && cfbh != null && cfbh != "请选择"){
    		attrstr += "&vWareHouseCode="+cfbh;
    	}
    	if(lsxz != "" && lsxz != null && lsxz != "请选择"){
    		attrstr += "&vGraPorCode="+lsxz;
    	}
    	if(endtime != "" && endtime != null){
    		attrstr += "&vEndTime="+endtime;
    	}
    	if(zylx != "" && zylx != null && zylx != "请选择"){
    		attrstr += "&vDirection="+zylx;
    	}
    	if(lspz != "" && lspz != null && lspz != "请选择"){
    		attrstr += "&vGraTypeCode="+lspz;
    	}
    	if(lsdj != "" && lsdj != null && lsdj != "请选择"){
    		attrstr += "&vGrainLevel="+lsdj;
    	}
    	if(nianfen != "" && nianfen != null && nianfen != "请选择"){
    		attrstr += "&vHarvestPeriod="+nianfen;
    	}
    	$(".datatables").attr("data-queryparam",attrstr);
    	datatable.ajax.reload(null,true);
    }
    
    function showsp(){
    	if($("#u1125if").attr("src") == ""){
    		//加载视频
        	$.ajax({
        		url:'${ctxPath}/shouchukeshihua/readshiping',
        		type:'post',
        		data:{"qyzzjgdm":qyzzjgdm,"kdbm":kdbm},
        		dataType:'json',
        		success:function(data){
        			var videoip = data[0].ip;
        			var user = data[0].user;
        			var password = data[0].password;
        			for(var i = 0; i < data.length ; i++){
        				var cameraIndex = data[i].videopoint;
        				if(data[i].videoname == "报港处"){
        					var spurl = '${ctxPath}/shouchukeshihua/churuku/shiping.html?videoip='+videoip+'&user='+user+'&password='+password+'&cameraIndex='+cameraIndex;
        					$("#u1125if").attr("src",spurl);
        				}else if(data[i].videoname == "质检处"){
        					var spurl = "${ctxPath}/shouchukeshihua/churuku/shiping.html"+
        					"?videoip="+videoip+"&user="+user+"&password="+password+"&cameraIndex="+cameraIndex;
        					$("#u1127if").attr("src",spurl);
        				}else if(data[i].videoname == "称重处"){
        					var spurl = "${ctxPath}/shouchukeshihua/churuku/shiping.html"+
        					"?videoip="+videoip+"&user="+user+"&password="+password+"&cameraIndex="+cameraIndex;
        					$("#u1129if").attr("src",spurl);
        				}else if(data[i].videoname == "入库处"){
        					var spurl = "${ctxPath}/shouchukeshihua/churuku/shiping.html"+
        					"?videoip="+videoip+"&user="+user+"&password="+password+"&cameraIndex="+cameraIndex;
        					$("#u1131if").attr("src",spurl);
        				}
        			}
        		},
        		error:function(){
        			alert("error");
        		}
        	});
    	}
    	 $("#spclose").toggle();	 
    }

    </script>

    <div id="base" class="">
    
    <div style="width:100%">
    	<p style="padding-right:20px;width:100%;text-align:right">单位：吨</p>
    	<div style="width:50%">
    		<h5 style="color:black;width:100%;font-weight:bold;text-align:center">库存占比</h5>
    		
	    	<div id="kczbtb" class="kczbtb">
	    	
	    	</div>
	    	<div id="kcmm" class="kcmm">
	    		<p  class="u1128">实时库存:</p><p id="ukucun" class="uu1124">0.000</p>
				<p  class="u1128">剩余仓容:</p><p id="usykucun" class="uu1124">0.000</p>
	    	</div>
    	</div>
    	
    	<div class="zhongjian"  style="width:50%">
    		<h5 id="djlsxz" style="color:black;width:100%;font-weight:bold;text-align:center">当季各粮食性质收购量</h5>
    		<div id="lsxx" class="lsxx">
    			
    		</div>
	    	<div class="lsxzmx">
	    	<!-- 
	    		<p  class="u1128">总库存:</p><p id="uu1122" class="uu1124">0.000</p>
	    	-->
	    		<p  class="u1128">中央储备粮:</p><p id="zycb" class="uu1124">0.000</p>
				<p  class="u1128">省级储备粮:</p><p id="sjcb" class="uu1124">0.000</p>
				<p  class="u1128">市级储备粮:</p><p id="shjcb" class="uu1124">0.000</p>
				<p  class="u1128">县级储备粮:</p><p id="xjcb" class="uu1124">0.000</p>
				<p  class="u1128">临时储备粮:</p><p id="lscb" class="uu1124">0.000</p>
				<p  class="u1128">商品粮:</p><p id="spl" class="uu1124">0.000</p>
				<p  class="u1128">最低价收购:</p><p id="zdj" class="uu1124">0.000</p>
				<p  class="u1128">其他储备粮:</p><p id="qtcb" class="uu1124">0.000</p>
	    	</div>
    	</div>
    </div>
    
    <div style="width:300px">
		<a href="javascript:void(0)" onclick="showsp()">显示/隐藏视频</a>
	</div>

	<div id="spclose" style="width:980px; display:none">
      <!-- Unnamed (图片) -->
      <div id="u1125" class="shiping">
      	<p>报港:</p>
      	<iframe id="u1125if" src=""  style="width:230px;height:230px"></iframe>
     
        <!-- Unnamed () -->
        <div id="u1126" class="text" style="display: none; visibility: hidden">
          <p><span style="font-family:'应用字体 Regular', '应用字体';"></span></p>
        </div>
      </div>

      <!-- Unnamed (图片) -->
      <div id="u1127" class="shiping">
      	<p>质检:</p>
        <iframe id="u1127if" src=""  style="width:230px;height:230px"></iframe>
        <!-- Unnamed () -->
        <div id="u1128" class="text" style="display: none; visibility: hidden">
          <p><span style="font-family:'应用字体 Regular', '应用字体';"></span></p>
        </div>
      </div>

      <!-- Unnamed (图片) -->
      <div id="u1129" class="shiping">
      	<p>称重:</p>
        <iframe id="u1129if" src=""  style="width:230px;height:230px"></iframe>
        <!-- Unnamed () -->
        <div id="u1130" class="text" style="display: none; visibility: hidden">
          <p><span style="font-family:'应用字体 Regular', '应用字体';"></span></p>
        </div>
      </div>

      <!-- Unnamed (图片) -->
      <div id="u1131" class="shiping">
      	<p>入库:</p>
        <iframe id="u1131if" src=""  style="width:230px;height:230px"></iframe>
        <!-- Unnamed () -->
        <div id="u1132" class="text" style="display: none; visibility: hidden">
          <p><span style="font-family:'应用字体 Regular', '应用字体';"></span></p>
        </div>
      </div>
      </div>
      
      <div class="form-inline" >
      		<!-- 2017-07-05  注释 -->
      		<!-- <div class = "div-nianfen">  
				<label>年份:</label>
				<select class="form-control input-sm input-sm-nianfen" style="width:80px;" name="gongdi" style="width:100px;">
					<option value="请选择">全部</option>
				</select>
			</div> -->
      		<div class = "div-time" style="">
				<label>日期:</label>
				<input size="16" type="text"  readonly class="form_datetimebegin" style="width:100px;"> 
				<!-- 
				<input class="form-control input-sm input-sm-time"  name="gongdi" style="width:80px;" type="date" />
				 -->
				<label>至</label>
				<input size="16" type="text" readonly class="form_datetimeend" style="width:100px;">
				<!-- 
				<input class="form-control input-sm input-sm-endtime"  name="gongdi" style="width:80px;" type="date" />
				 -->
			</div>
			<div class = "div-lsxz" style="margin-left:10px">
				<label>性质:</label>
				<select class="form-control input-sm input-sm-lsxz" name="gongdi" style="width:80px;">
					<option value="">全部</option>
					<option value = "11">中央储备粮</option>
					<option value = "121">省级储备粮</option>
					<option value = "122">市级储备粮</option>
					<option value = "123">县级储备粮</option>
					<option value = "32">临时储备粮</option>
					<option value = "2">商品粮</option>
					<option value = "31">最低价收购</option>
					<option value = "99">其他储备粮</option>
				</select>
			</div>
			<div class = "div-lspz" style="margin-left:10px">
				<label>品种:</label>
				<select class="form-control input-sm input-sm-lspz" name="gongdi" style="width:80px;">
					<option value="">全部</option>
					<option value = "111">小麦</option>
					<option value = "113">稻谷</option>
					<option value = "112">玉米</option>
					<option value = "1132">粳稻</option>
					<option value = "1131">籼稻</option>
				</select>
			</div>
			<div class = "div-lsdj" style="margin-left:10px">
				<label>等级:</label>
				<select class="form-control input-sm input-sm-lsdj" name="gongdi" style="width:70px;">
				</select>
			</div>
			<div class = "div-zylx" style="margin-left:10px">
				<label>作业类型:</label>
				<select class="form-control input-sm input-sm-zylx" name="gongdi" style="width:80px;">
					<option value = "请选择">全部</option>
					<option value = "入库">入库</option>
					<option value = "出库">出库</option>
					<option value = "出库损耗">出库损耗</option>
					<option value = "收购">收购</option>
					<option value = "销售">销售</option>
					<option value = "倒仓">倒仓</option>
					<option value = "定性">定性</option>
				</select>	
			</div>
			<a class="btn btn-success btn-xs" type="button"   onclick="doSearch()" style="margin-left:10px"><i class="fa fa-search" aria-hidden="true">&nbsp;查询</i></a>
	  </div>
      <!-- Unnamed (表格) -->
      
      <div id="u1133" class="biaoge" style="width:1000px"> 
         <div  style="width:100%;margin-left:0px">
          	<table   class="table table-striped table-hover table-bordered datatables" data-url="${ctxPath}/shouchukeshihua/querymingxi.do?isedit=2" >
	            	<thead style="font-size:16px;border-collapse:collapse">
				          	<tr style="color:black;font-size:16px;">
				          		<th style="vertical-align:middle;text-align:center;width: 60px;">流水号</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">日期</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">车船号</th>
	               				<th style="vertical-align:middle;text-align:center;width: 60px;">粮食</br>品种</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">粮食</br>性质</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">数量</br>(吨)</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">收获</br>年限</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">等级</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">仓房号</th>
	                			<th style="vertical-align:middle;text-align:center;width: 60px;">作业</br>类型</th>
	            			</tr>
	            			<tr id="hejitr" style="font-size:14px;">
	            				<th style="text-align:left;font-weight: normal;width: 60px;">合计</th>
	                			<th style="text-align:left;width: 60px;"></th>
	                			<th style="text-align:left;width: 60px;"></th>
	               				<th style="text-align:left;width: 60px;"></th>
	                			<th style="text-align:left;width: 60px;"></th>
	                			<th id="mxheji" style="text-align:left;font-weight: normal;width: 60px;"></th>
	                			<th style="text-align:left;width: 60px;"></th>
	                			<th style="text-align:left;width: 60px;"></th>
	                			<th style="text-align:left;width: 60px;"></th>
	                			<th style="text-align:left;width: 60px;"></th>
	            			</tr>
	            	</thead>
   			</table>
		</div>
      </div>
    </div>
<%
	}
%>
  